{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://browserbox.dev/schemas/scripts-metadata.schema.json",
  "title": "Scripts Metadata",
  "description": "Schema for scripts/metadata.json in BrowserBox configuration packages",
  "type": "array",
  "items": {
    "type": "object",
    "required": [
      "id",
      "title",
      "description", 
      "filename"
    ],
    "properties": {
      "id": {
        "type": "string",
        "pattern": "^[a-z0-9-_]+$",
        "minLength": 1,
        "maxLength": 50,
        "description": "Unique identifier for this script"
      },
      "title": {
        "type": "string",
        "minLength": 1,
        "maxLength": 100,
        "description": "Human-readable script name displayed in the UI"
      },
      "description": {
        "type": "string",
        "minLength": 10,
        "maxLength": 500,
        "description": "Detailed explanation of what this script accomplishes"
      },
      "filename": {
        "type": "string",
        "pattern": "^[^<>:\"/\\\\|?*]+\\.py$",
        "description": "Python script filename in the scripts/ directory"
      },
      "category": {
        "type": "string",
        "enum": ["analysis", "visualization", "processing", "reporting", "modeling", "cleaning"],
        "description": "Script category for organization and filtering"
      },
      "dependencies": {
        "type": "array",
        "items": {
          "type": "object",
          "required": ["type"],
          "properties": {
            "type": {
              "type": "string",
              "enum": ["uploaded", "script", "external"]
            },
            "sourceId": {
              "type": "string",
              "description": "ID of the required dependency"
            },
            "description": {
              "type": "string",
              "description": "Description of how this dependency is used"
            }
          },
          "if": {
            "properties": {
              "type": { "const": "uploaded" }
            }
          },
          "then": {
            "required": ["sourceId"],
            "properties": {
              "sourceId": {
                "description": "File requirement ID that this script depends on"
              }
            }
          },
          "else": {
            "if": {
              "properties": {
                "type": { "const": "script" }
              }
            },
            "then": {
              "required": ["sourceId"],
              "properties": {
                "sourceId": {
                  "description": "Script ID that must be executed first"
                }
              }
            }
          }
        },
        "description": "Dependencies required for this script to run"
      },
      "parameters": {
        "type": "object",
        "properties": {
          "timeout": {
            "type": "number",
            "minimum": 1,
            "maximum": 300,
            "default": 30,
            "description": "Maximum execution time in seconds"
          },
          "memory": {
            "type": "number",
            "minimum": 64,
            "maximum": 2048,
            "default": 256,
            "description": "Memory limit in MB"
          }
        },
        "additionalProperties": false
      },
      "outputs": {
        "type": "object",
        "properties": {
          "produces": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": ["table", "chart", "report", "data", "model"]
            },
            "description": "Types of output this script generates"
          },
          "formats": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": ["html", "json", "csv", "png", "pdf"]
            },
            "description": "Output file formats"
          }
        },
        "additionalProperties": false
      },
      "tags": {
        "type": "array",
        "items": {
          "type": "string",
          "minLength": 1,
          "maxLength": 30
        },
        "maxItems": 10,
        "description": "Tags for searching and filtering scripts"
      },
      "estimatedRuntime": {
        "type": "string",
        "pattern": "^(fast|medium|slow)$",
        "description": "Expected runtime category for user planning"
      },
      "complexity": {
        "type": "string",
        "pattern": "^(beginner|intermediate|advanced)$",
        "description": "Complexity level for user guidance"
      }
    },
    "additionalProperties": false
  },
  "examples": [
    [
      {
        "id": "sales-summary",
        "title": "Sales Summary Analysis",
        "description": "Generate comprehensive summary statistics and trends for sales data including revenue, customer counts, and product performance.",
        "filename": "sales_summary.py",
        "category": "analysis",
        "dependencies": [
          {
            "type": "uploaded",
            "sourceId": "sales_data",
            "description": "Primary sales transaction data"
          }
        ],
        "parameters": {
          "timeout": 60,
          "memory": 512
        },
        "outputs": {
          "produces": ["table", "chart"],
          "formats": ["html", "json"]
        },
        "tags": ["sales", "summary", "statistics"],
        "estimatedRuntime": "fast",
        "complexity": "beginner"
      },
      {
        "id": "advanced-forecasting",
        "title": "Sales Forecasting Model",
        "description": "Build and train time series forecasting models using advanced statistical techniques to predict future sales trends.",
        "filename": "forecasting_model.py", 
        "category": "modeling",
        "dependencies": [
          {
            "type": "script",
            "sourceId": "sales-summary",
            "description": "Requires cleaned and summarized data"
          }
        ],
        "parameters": {
          "timeout": 180,
          "memory": 1024
        },
        "outputs": {
          "produces": ["model", "chart", "report"],
          "formats": ["html", "json", "png"]
        },
        "tags": ["forecasting", "time-series", "modeling", "advanced"],
        "estimatedRuntime": "slow",
        "complexity": "advanced"
      }
    ]
  ]
}